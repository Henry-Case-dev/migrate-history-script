# Ì∫Ä Telegram History Migration Tool

> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ Telegram —á–∞—Ç–æ–≤ –≤ PostgreSQL —Å AI-–≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Gemini API

[![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-336791?style=flat&logo=postgresql)](https://www.postgresql.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Go (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

**Windows:**
```bash
# –°–∫–∞—á–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫: https://go.dev/dl/
# –ò–ª–∏ —á–µ—Ä–µ–∑ Chocolatey:
choco install golang
```

**Linux/Mac:**
```bash
# Linux
sudo apt-get install golang-go

# Mac
brew install go
```

–ü—Ä–æ–≤–µ—Ä–∫–∞: `go version` (–¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å Go 1.21+)

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
git clone https://github.com/Henry-Case-dev/migrate-history-script.git
cd migrate-history-script
go mod download
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# PostgreSQL
POSTGRESQL_HOST=your_host
POSTGRESQL_PORT=5432
POSTGRESQL_USER=your_user
POSTGRESQL_PASSWORD=your_password
POSTGRESQL_DBNAME=your_database

# Gemini API
GEMINI_API_KEY=your_gemini_api_key
GEMINI_EMBEDDING_MODEL_NAME=embedding-001

# Retry –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
EMBEDDING_MAX_RETRIES=0  # 0 = –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–∂–∏–º —Å 24—á —Ç–∞–π–º–∞—É—Ç–æ–º

# Rate Limiting (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è Tier 1)
EMBEDDING_REQUESTS_PER_MINUTE=240
EMBEDDING_REQUESTS_PER_DAY=24000
EMBEDDING_REQUEST_DELAY=0.3s
```

### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–º–µ—Å—Ç–∏—Ç–µ JSON —Ñ–∞–π–ª—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ Telegram –≤ –ø–∞–ø–∫—É `data/`:

```
data/
‚îú‚îÄ‚îÄ chat_export_1.json
‚îú‚îÄ‚îÄ chat_export_2.json
‚îî‚îÄ‚îÄ ...
```

### 5. –ó–∞–ø—É—Å–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
go run cmd/test_setup/main.go

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
go run main.go

# –ò–ª–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
go build -o migrate_history.exe
./migrate_history.exe
```

### 6. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# Graceful –æ—Å—Ç–∞–Ω–æ–≤–∫–∞: Ctrl+C
# –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç:
./migrate_history.exe
```

---

## Ì≥ã –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è JSON ‚Üí PostgreSQL** - –ø–µ—Ä–µ–Ω–æ—Å –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ **AI-–≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —É–º–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —á–µ—Ä–µ–∑ Gemini API
- ‚úÖ **–í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π retry —Ä–µ–∂–∏–º** - –≥–∞—Ä–∞–Ω—Ç–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –∫–≤–æ—Ç API
- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤** - —ç–∫–æ–Ω–æ–º–∏—è API –≤—ã–∑–æ–≤–æ–≤

---

## Ì≥ã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **Go** | 1.21+ | –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| **PostgreSQL** | 13+ —Å pgvector | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º |
| **Gemini API** | Tier 1+ | –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (240 req/min) |
| **–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** | ~500MB | –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö |

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pgvector

```sql
-- –í PostgreSQL –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
CREATE EXTENSION IF NOT EXISTS vector;
```

---

## Ì¥Ñ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### Ìª°Ô∏è –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–∂–∏–º (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```env
EMBEDDING_MAX_RETRIES=0
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –¥–æ —É—Å–ø–µ—Ö–∞ –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–∞ (24 —á–∞—Å–∞)
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 60 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- ‚úÖ –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** production, –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –ø–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

### ÌæØ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º

```env
EMBEDDING_MAX_RETRIES=5
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –î–µ–ª–∞–µ—Ç 5 –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 2—Å ‚Üí 4—Å ‚Üí 8—Å ‚Üí 16—Å ‚Üí 32—Å (max 60—Å)
- ‚ö†Ô∏è –ü—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –±—ã—Å—Ç—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

---

## Ì∫¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º

### –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ó–∞–ø—É—Å–∫
./migrate_history.exe

# Graceful –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
Ctrl+C

# –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./migrate_history.exe

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ (Linux/Mac)
nohup ./migrate_history.exe > migration.log 2>&1 &

# Windows (PowerShell)
Start-Process -NoNewWindow -FilePath ".\migrate_history.exe" -RedirectStandardOutput "migration.log"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f migration.log

# –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
cat migration_state.json | jq '.'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç API
grep "Rate limit\|API:" migration.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î

```sql
-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
    COUNT(*) as total_messages,
    COUNT(embedding) as vectorized_messages,
    ROUND(COUNT(embedding) * 100.0 / COUNT(*), 2) as percent
FROM messages;

-- –¢–æ–ø-10 —á–∞—Ç–æ–≤
SELECT chat_id, COUNT(*) as messages
FROM messages 
GROUP BY chat_id 
ORDER BY messages DESC 
LIMIT 10;
```

---

## Ìª°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ü—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞ –¥—Ä—É–≥—É—é –º–∞—à–∏–Ω—É **–¥–∞–Ω–Ω—ã–µ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è**:

1. ‚úÖ `migration_state.json` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∏–Ω–¥–µ–∫—Å—ã
2. ‚úÖ PostgreSQL UNIQUE constraint –Ω–∞ `(chat_id, message_id)`
3. ‚úÖ `INSERT ... ON CONFLICT DO NOTHING` —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–î–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**

```bash
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è
scp migration_state.json user@server:/path/

# 2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –¥–æ—Å—Ç—É–ø–Ω–∞
psql -h your_host -U your_user -d your_database -c "SELECT COUNT(*) FROM messages;"

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ - –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
./migrate_history.exe
```

---

## Ì¥ß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -h your_host -p 5432 -U your_user -d your_database

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector
psql -h your_host -U your_user -d your_database -c "SELECT * FROM pg_extension WHERE extname='vector';"
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (host, port, user, password)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pgvector: `CREATE EXTENSION vector;`

### ‚è±Ô∏è –¢–∞–π–º–∞—É—Ç 24 —á–∞—Å–∞ (EMBEDDING_MAX_RETRIES=0)

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–æ–±–ª–µ–º—ã —Å Gemini API (–ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–∞)
- –ò—Å—á–µ—Ä–ø–∞–Ω–∏–µ –∫–≤–æ—Ç API
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Gemini API
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—ã: https://aistudio.google.com/app/apikey
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
4. –ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è - –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

### Ì∫´ –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API

```env
# –†–µ—à–µ–Ω–∏–µ 1: –£–º–µ–Ω—å—à–∏—Ç–µ –ª–∏–º–∏—Ç—ã –≤ .env
EMBEDDING_REQUESTS_PER_MINUTE=120  # –ë—ã–ª–æ 240
EMBEDDING_REQUEST_DELAY=0.6s       # –ë—ã–ª–æ 0.3s

# –†–µ—à–µ–Ω–∏–µ 2: –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Å–±—Ä–æ—Å–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
# Tier 1: –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É/–¥–µ–Ω—å

# –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫–ª—é—á
GEMINI_API_KEY=your_backup_key
```

---

## Ì≥ä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE TABLE messages (
    id SERIAL PRIMARY KEY,
    chat_id BIGINT NOT NULL,
    message_id INTEGER NOT NULL,
    user_id BIGINT,
    username TEXT,
    text TEXT,
    date_sent TIMESTAMP WITH TIME ZONE,
    embedding vector(768),        -- Gemini embedding-001
    context_text TEXT,
    UNIQUE(chat_id, message_id)
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX messages_embedding_idx 
ON messages 
USING ivfflat (embedding vector_cosine_ops);
```

---

## ÌæØ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)

```sql
-- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫)
SELECT 
    text,
    embedding <=> '[your_vector]'::vector as distance
FROM messages 
WHERE embedding IS NOT NULL
ORDER BY distance ASC 
LIMIT 10;

-- –ü–æ–∏—Å–∫ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —á–∞—Ç–µ
SELECT text, embedding <=> '[vector]'::vector as dist
FROM messages 
WHERE chat_id = 123456 AND embedding IS NOT NULL
ORDER BY dist ASC 
LIMIT 5;
```

---

## Ì≥Å –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
migrate-history-script/
‚îú‚îÄ‚îÄ main.go                    # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª (–º–∏–≥—Ä–∞—Ü–∏—è, retry –ª–æ–≥–∏–∫–∞)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/                # –ó–∞–≥—Ä—É–∑–∫–∞ .env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ storage/               # PostgreSQL –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ gemini/                # Gemini API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ llm/                   # LLM –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ utils/                 # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ test_setup/            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ë–î/API
‚îú‚îÄ‚îÄ data/                      # JSON —ç–∫—Å–ø–æ—Ä—Ç—ã Telegram
‚îú‚îÄ‚îÄ cache/                     # –ö—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îú‚îÄ‚îÄ migration_state.json       # –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ .env                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é)
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Rate Limiting

| Tier | Requests/min | Requests/day | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|------|--------------|--------------|--------------|
| **Free** | 15 | 1,500 | –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –∞—Ä—Ö–∏–≤–æ–≤ |
| **Tier 1** | 240 | 24,000 | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **Tier 2** | 1,000+ | 100,000+ | –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –∞—Ä—Ö–∏–≤–æ–≤ |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- ‚ö° –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (50 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –±–∞—Ç—á–µ)
- Ì≤æ –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- Ì¥Ñ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
- Ì≥â –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª–∏–º–∏—Ç–∞—Ö
- ÌæØ –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å —Ç–æ—á–Ω–æ–≥–æ checkpoint

---

## Ì≥û –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º:**

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
go run cmd/test_setup/main.go

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -n 100 migration.log

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
cat migration_state.json | jq '.'
```

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
- [Gemini API Documentation](https://ai.google.dev/docs)
- [PostgreSQL pgvector](https://github.com/pgvector/pgvector)
- [Issues](https://github.com/Henry-Case-dev/migrate-history-script/issues)

---

## Ì≥Ñ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE)

---

<div align="center">

**–ê–≤—Ç–æ—Ä:** [Henry-Case-dev](https://github.com/Henry-Case-dev)  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** [migrate-history-script](https://github.com/Henry-Case-dev/migrate-history-script)  

‚≠ê –ü–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É, –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –±—ã–ª –ø–æ–ª–µ–∑–µ–Ω!

</div>
